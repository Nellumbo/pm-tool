<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç API - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ü—Ä–æ–µ–∫—Ç–∞–º–∏</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f7fa; }
        .container { max-width: 800px; margin: 0 auto; }
        .card { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .btn { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        .btn:hover { background: #0056b3; }
        .result { background: #f8f9fa; padding: 10px; border-radius: 4px; margin-top: 10px; white-space: pre-wrap; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        h1 { color: #2c3e50; }
        h2 { color: #34495e; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ –¢–µ—Å—Ç API - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ü—Ä–æ–µ–∫—Ç–∞–º–∏</h1>
        
        <div class="card">
            <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
            <button class="btn" onclick="getStats()">–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
            <div id="stats" class="result"></div>
        </div>

        <div class="card">
            <h2>üìÅ –ü—Ä–æ–µ–∫—Ç—ã</h2>
            <button class="btn" onclick="getProjects()">–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–µ–∫—Ç—ã</button>
            <button class="btn" onclick="createProject()">–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç</button>
            <div id="projects" class="result"></div>
        </div>

        <div class="card">
            <h2>‚úÖ –ó–∞–¥–∞—á–∏</h2>
            <button class="btn" onclick="getTasks()">–ü–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞—á–∏</button>
            <button class="btn" onclick="createTask()">–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –∑–∞–¥–∞—á—É</button>
            <div id="tasks" class="result"></div>
        </div>

        <div class="card">
            <h2>üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2>
            <button class="btn" onclick="getUsers()">–ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</button>
            <div id="users" class="result"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';

        async function makeRequest(endpoint, method = 'GET', data = null) {
            try {
                const options = {
                    method,
                    headers: { 'Content-Type': 'application/json' }
                };
                if (data) options.body = JSON.stringify(data);
                
                const response = await fetch(`${API_BASE}${endpoint}`, options);
                const result = await response.json();
                return { success: true, data: result };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        function displayResult(elementId, result) {
            const element = document.getElementById(elementId);
            if (result.success) {
                element.className = 'result success';
                element.textContent = JSON.stringify(result.data, null, 2);
            } else {
                element.className = 'result error';
                element.textContent = `–û—à–∏–±–∫–∞: ${result.error}`;
            }
        }

        async function getStats() {
            const result = await makeRequest('/stats');
            displayResult('stats', result);
        }

        async function getProjects() {
            const result = await makeRequest('/projects');
            displayResult('projects', result);
        }

        async function createProject() {
            const projectData = {
                name: '–¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç',
                description: '–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ API',
                status: 'active',
                startDate: new Date().toISOString().split('T')[0],
                endDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]
            };
            const result = await makeRequest('/projects', 'POST', projectData);
            displayResult('projects', result);
            if (result.success) getProjects(); // –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫
        }

        async function getTasks() {
            const result = await makeRequest('/tasks');
            displayResult('tasks', result);
        }

        async function createTask() {
            // –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∏–º –ø—Ä–æ–µ–∫—Ç—ã, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É
            const projectsResult = await makeRequest('/projects');
            if (!projectsResult.success || projectsResult.data.length === 0) {
                displayResult('tasks', { success: false, error: '–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç' });
                return;
            }

            const taskData = {
                title: '–¢–µ—Å—Ç–æ–≤–∞—è –∑–∞–¥–∞—á–∞',
                description: '–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ API',
                priority: 'medium',
                status: 'todo',
                projectId: projectsResult.data[0].id,
                dueDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]
            };
            const result = await makeRequest('/tasks', 'POST', taskData);
            displayResult('tasks', result);
            if (result.success) getTasks(); // –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫
        }

        async function getUsers() {
            const result = await makeRequest('/users');
            displayResult('users', result);
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            getStats();
            getUsers();
        };
    </script>
</body>
</html>
